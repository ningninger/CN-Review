# 传输层协议

## UDP

UDP应用

+ DNS
+ 流媒体应用需要快速传输数据



## TCP

+ 重复的ACK丢失
  + 当发送方收到了重复的ACK，表明之前发送的某个分组已经到达接收方，而发送方此时却没有收到新的ACK确认。
  + 当发送方接收到重复的ACK时，它会认为之前发送的分组丢失，并触发快速重传机制，立即重新发送丢失的分组。
  + 在重传后有两种选择
    + 发送丢失的分组并将滑动窗口移动k个重复的ACK数，这种方法可以加快传输速度，因为在重传时立即将滑动窗口向前移动，不需要等待新的ACK确认。但是这种方法可能是错的
    + 发送丢失的分组，并等待收到ACK确认后再移动滑动窗口
    + 通常的处理方式是第一种



+ 设计超时值
  + 采用样本RTT
  + 估计RTT
  + 估计偏差
  + 超时计算



## Karn/Partridge算法

+ 不适用重传时的样本往返时间。当发生数据包重传时，算法忽略该数据包的往返时间测量
+ 指数退避算法，当RTO定时器超时时，将RTO翻倍，为原来的2倍，最大值不能超过60s
+ 每当收到一个新的测量值，将RTO重置为两倍的EstimatedRTT



## 连接的建立

+ 如果是两次握手
  + 如何识别旧连接中的滑动段
  + 如何识别重复的过时SYN
  + ISN
    + ISN的目的是确保每个新连接的序列号与之前的连接不冲突，从而避免旧连接的数据对新连接的干扰
+ 如果是三次握手
  + 主机A发送SYN：主机A想要与主机B建立TCP连接，因此它发送一个带有SYN标志的TCP报文段。这个SYN报文段的序列号用于同步上方的初始序列号
  + 主机B返回SYN ACK：一旦主机B收到主机A的请求，他会发送一个Ack，并且告诉主机A自己的初始序列号
  + 主机A发送ACK



## 连接的拆除

+ 一次一边中断连接
  + 当主机甲向主机丙发送FIN信息，主机丙发送ACK，这个时候主机甲保持半断开状态，直到主机丙发送了FIN信息，这样两个主机的连接就中断了
+ 同时断开
  + 当主机甲向主机丙发送了FIN信息，主机丙回复ACK，但是这个ACK中也保存这丙的FIN信息，主机甲收到后回复ACK，这样两个主机的连接就同时断开了
+ 突然中止
  + 主机甲突然中止连接了，会给主机丙发送一个重置报文，会告诉主机丙立即断开连接，这并不需要ACK，如果主机丙继续发送报文，那么其还会只收到一个重置报文



