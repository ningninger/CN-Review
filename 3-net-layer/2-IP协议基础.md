# IP协议基础

IP协议层在每个主机和路由器上，它提供的是无连接服务，也就是数据包机制



## 互联网寻址

### 寻址级别

+ 物理网络寻址
+ 网际网络寻址（IP地址）
+ 应用地址（进程标识符）

### 寻址范围

+ 全局地址（全局非歧义）
+ 网络附加地址（特定网络上每个设备接口的唯一地址）
+ 端口地址（端口）：位于网络级别之上，在系统内部是唯一的，在系统外部不需要唯一

### 寻址模式

+ 单播地址：用于只想单个系统或端口的地址
+ 广播地址：与特定域的所有实体之间进行通信
+ 组播地址：用于特定实体的子集
+ 任播地址：用在特定子集中的任意之间进行通信



## IP操作

+ 路由
+ 数据包生存期
+ 分片与重组
+ 错误控制
+ 流量控制



### 路由

+ 静态路由：路由表中的内容是已预先配置的，不会自动调整，包含备选路由，以便在主路径不可用时选择替代路径
+ 动态路由：动态选择最佳路由
+ 路由策略：根据距离向量、链路状态和路径向量
+ 源路由：源主机指定数据报的路由路径，以顺序的路由器列表的形式指定
+ 路由记录：数据报将经过的路由信息记录在数据报里



### 生存周期

TTL：IP数据报中的一个字段，没经过一个路由器，TTL的值被减少。当TTL的值降至0时，数据报被丢弃。



### 分段与重组

+ 分段：如果在传输过程中，如果个数据包的长度超过了当前网络的最大传输单元（MTU），需要将数据报分割成更小的片段，以便能够在网络中传输。

+ 重组：在目的地或下一个路由器，接收到的分段需要进行重组，以还原原始的数据包。 重组过程中需要使用数据包中的分段标识字段和偏移量字段来确定
+ 分段和重组的限制：由于分段的片段可能采用不同的路由路径传输，因此路由器通常无法进行分段的重组操作。因此分段和重组主要由发送方和目的主机负责

+ 处理故障：
  + 在接收到第一个分段时，为重组操作分配一个超时时间
  + 使用数据包生存时间：每个数据包都有一个TTL字段，每个分组到达递减

+ 为什么要将数据报在向上传递的时候进行重组：
  + 保证数据的完整性和正确性
+ 分段与重组的信息
  + 标识符
  + 分段偏移：记录的是字节数，而表示帧的长度的是比特数
  + 分段标志：标明这是否是这个包的结束



#### 过程

+ 必须准备足够的缓冲空间
+ 根据标识符和偏移量将分片插入缓冲区
+ 使用更多的标志判断这是否是最后一个分片
+ 进行重组直到最后的数据字段被重组



### 错误控制

+ 未能保证的传输
+ 路由器通知源节点如果数据报被丢弃了
  + ​	如果checksum失败，TTL过期
+ ICMP数据报被用于去发送错误信息
+ 高层协议通知





### 流量控制

+ 允许路由器限制传入数据的速率
  + 在无线系统中流量控制有线，但很快就会出现新的机制
+ 当缓存已满，路由器会丢弃传入的数据报
  + 使用ICMP通知发送主机



## IP包的结构

数据报的最大长度是65535个字节





## IP地址

+ 32位全局互联网地址
+ 包含了网络（高位）和主机（低位）
+ 将32位的二进制地址表示为四个十进制数
+ 主机部分则在指定的组织内进行分配，确保网络内每个主机具有唯一的地址



### CLASS A

+ 在二进制表示中，以0开头
+ 1.x.x.x to 126.x.x.x
+ 最高位的0保留为默认路由和本地回环地址
+ 第一个字节为网络号，后三个字节用于主机号
+ 每个class A 网络可以支持最多一千六百万个主机
+ 所有的已经被分配了



#### 按照标号一共有ABCDE，到C都是基本被分配完毕了



### 子网和子网掩码

+ 处理网络地址不足的问题：通过将主机部分的地址划分成子网号和主机号，来解决
+ 子网和子网掩码的划分
  + 子网号：标识子网
  + 主机号：标识具体主机
  + 为每个局域网分配子网号
    + 本地路由器在子网中进行路由，不需要经过全局的路由器
+ 子网看起来像一个单一的网络：将互联网整体和子网的增长和路由复杂性隔离开来，提供了更好的扩展性和管理性





### CIDR

+ CIDR（无类别域名路由选择），IP地址被表示为A.B.C.D/n，其中n被成为IP（网络前缀）

### 路由聚合

将多个具有相同路由策略的网络地址合并成一个更大的网络块的过程



